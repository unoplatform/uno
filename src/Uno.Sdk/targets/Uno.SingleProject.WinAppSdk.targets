<Project>
	<PropertyGroup>
		<UseWinUI>true</UseWinUI>
		<OutputType>WinExe</OutputType>
		<!-- Bundles the WinAppSDK binaries -->
		<WindowsAppSDKSelfContained Condition="$(WindowsAppSDKSelfContained) == ''">true</WindowsAppSDKSelfContained>
	</PropertyGroup>

	<PropertyGroup>
		<ApplicationManifest Condition=" $(ApplicationManifest) == '' ">$(WindowsProjectFolder)app.manifest</ApplicationManifest>
		<Platforms Condition=" $(Platforms) == '' ">x86;x64;arm64</Platforms>

		<WindowsAppxManifestPath>$(WindowsProjectFolder)Package.appxmanifest</WindowsAppxManifestPath>
		<WindowsAppxManifestPath Condition="!Exists($(WindowsAppxManifestPath)) and Exists('Package.appxmanifest')">Package.appxmanifest</WindowsAppxManifestPath>

		<WindowsPackageType Condition="'$(WindowsPackageType)'=='' and Exists('$(WindowsAppxManifestPath)')">MSIX</WindowsPackageType>
		<WindowsPackageType Condition="'$(WindowsPackageType)'==''">None</WindowsPackageType>
	</PropertyGroup>

	<!-- Required to allow `dotnet build` to work without extra parameters -->
	<PropertyGroup Condition="'$(Platform)' == 'AnyCPU' AND $(Optimize) != 'true'">
		<Platform>$([System.Runtime.InteropServices.RuntimeInformation]::OSArchitecture)</Platform>
	</PropertyGroup>

	<ItemGroup>
		<!-- Exclude Manifest items that have already been added to avoid duplicates -->
		<Manifest Include="$(ApplicationManifest)"
			Exclude="@(Manifest)"
			IsDefaultItem="true"
			Link="$([MSBuild]::MakeRelative ('$(MSBuildProjectDirectory)', '%(Identity)'))" />
	</ItemGroup>

	<!--
		Sanity Check...
		The AppxManifest should have come in automatically but if it didn't for some reason we need
		to ensure that it is added here to prevent the build from failing.
	-->
	<Target Name="_EnsureAppxManifestExists"
		BeforeTargets="_ValidateWindowsPackageType"
		Condition="'$(WindowsPackageType)' != 'None' and Exists('$(WindowsAppxManifestPath)') and  '@(AppxManifest)'==''">
		<ItemGroup>
			<AppxManifest Include="$(WindowsAppxManifestPath)"
				IsDefaultItem="true"
				SubType="Designer" />
		</ItemGroup>
	</Target>
</Project>
