<Project>
	<Import Project="$(MSBuildThisFileDirectory)Uno.Default.PackageVersions.targets" />
	<Import Project="$(MSBuildThisFileDirectory)Uno.Implicit.Packages.ProjectSystem.targets" />

	<UsingTask TaskName="Uno.Sdk.ImplicitPackagesResolver"
		AssemblyFile="$(MSBuildThisFileDirectory)netstandard2.0\Uno.Sdk.dll" />
	<PropertyGroup>
		<UnoTarget>$([MSBuild]::GetTargetPlatformIdentifier('$(TargetFramework)'))</UnoTarget>
		<UnoTarget Condition="$(TargetFramework.Contains('windows10'))">windows10</UnoTarget>
		<UnoTarget Condition="$(UnoTarget) == ''">reference</UnoTarget>
		<UnoImplicitPackages_BeforeTargets>
			ResolveFrameworkReferencesDesignTime;
			ResolveProjectReferencesDesignTime2;
			ResolvePackageDependencies;
			CollectPackageReferences;
			ProcessFrameworkReferences;
		</UnoImplicitPackages_BeforeTargets>
	</PropertyGroup>

	<Target Name="UnoImplicitPackages" BeforeTargets="$(UnoImplicitPackages_BeforeTargets)">
		<PropertyGroup>
			<_UnoCacheFolder>$([System.IO.Path]::GetFullPath('$(IntermediateOutputPath)'))</_UnoCacheFolder>
		</PropertyGroup>

		<ImplicitPackagesResolver
				IntermediateOutput="$(_UnoCacheFolder)"
				SdkDebugging="$(UnoSdkDebugging)"
				SingleProject="$(_IsUnoSingleProjectAndLegacy)"
				Optimize="$(Optimize)"
				OutputType="$(OutputType)"
				UnoFeatures="$(UnoFeatures)"
				IsPackable="$(IsPackable)"
				TargetFrameworkIdentifier="$(UnoTarget)"
				ProjectName="$(MSBuildProjectName)"
				PackageReferences="@(PackageReference)"
				PackageVersions="@(PackageVersion)"
				UnoVersion="$(UnoVersion)"
				MauiVersion="$(MauiVersion)"
				UnoExtensionsVersion="$(UnoExtensionsVersion)"
				UnoToolkitVersion="$(UnoToolkitVersion)"
				UnoThemesVersion="$(UnoThemesVersion)"
				UnoCSharpMarkupVersion="$(UnoCSharpMarkupVersion)"
				SkiaSharpVersion="$(SkiaSharpVersion)"
				UnoLoggingVersion="$(UnoLoggingVersion)"
				WindowsCompatibilityVersion="$(WindowsCompatibilityVersion)"
				UnoWasmBootstrapVersion="$(UnoWasmBootstrapVersion)"
				UnoUniversalImageLoaderVersion="$(UnoUniversalImageLoaderVersion)"
				AndroidMaterialVersion="$(AndroidMaterialVersion)"
				UnoResizetizerVersion="$(UnoResizetizerVersion)"
				MicrosoftLoggingVersion="$(MicrosoftLoggingVersion)"
				WinAppSdkVersion="$(WinAppSdkVersion)"
				WinAppSdkBuildToolsVersion="$(WinAppSdkBuildToolsVersion)"
				UnoCoreLoggingSingletonVersion="$(UnoCoreLoggingSingletonVersion)"
				UnoDspTasksVersion="$(UnoDspTasksVersion)"
				CommunityToolkitMvvmVersion="$(CommunityToolkitMvvmVersion)"
				PrismVersion="$(PrismVersion)"
				AndroidXNavigationVersion="$(AndroidXNavigationVersion)"
				AndroidXCollectionVersion="$(AndroidXCollectionVersion)"
				MicrosoftIdentityClientVersion="$(MicrosoftIdentityClientVersion)"
				Condition=" '$(TargetFramework)' != '' ">
			<Output ItemName="_UnoImplicitPackageReference"
					TaskParameter="ImplicitPackages" />
			<Output ItemName="_UnoRemovePackageVersions"
					TaskParameter="RemovePackageVersions" />
		</ImplicitPackagesResolver>

		<ItemGroup Condition=" '$(TargetFramework)' != '' ">
			<PackageVersion Remove="@(_UnoRemovePackageVersions)" />
			<PackageReference Include="@(_UnoImplicitPackageReference)" />
			<_UnoImplicitPackageReference Remove="@(_UnoImplicitPackageReference)" />
			<_UnoRemovePackageVersions Remove="@(_UnoRemovePackageVersions)" />
		</ItemGroup>
	</Target>

</Project>
