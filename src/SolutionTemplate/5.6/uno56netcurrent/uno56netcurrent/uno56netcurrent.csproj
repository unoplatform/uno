<Project Sdk="Uno.Sdk.Private">
    <PropertyGroup>
        <TargetFrameworks>net10.0-desktop;net10.0-browserwasm</TargetFrameworks>

        <OutputType>Exe</OutputType>
        <UnoSingleProject>true</UnoSingleProject>

        <!-- Display name -->
        <ApplicationTitle>uno56netcurrent</ApplicationTitle>
        <!-- App Identifier -->
        <ApplicationId>com.companyname.uno56netcurrent</ApplicationId>
        <!-- Versions -->
        <ApplicationDisplayVersion>1.0</ApplicationDisplayVersion>
        <ApplicationVersion>1</ApplicationVersion>
        <!-- Package Publisher -->
        <ApplicationPublisher>uno56netcurrent</ApplicationPublisher>
        <!-- Package Description -->
        <Description>uno56netcurrent powered by Uno Platform.</Description>

        <!--
      UnoFeatures let's you quickly add and manage implicit package references based on the features you want to use.
      https://aka.platform.uno/singleproject-features
    -->
        <UnoFeatures>
            SkiaRenderer;
        </UnoFeatures>
    </PropertyGroup>

    <ItemGroup>
        <PackageReference Include="Microsoft.Extensions.Diagnostics.Testing" />
    </ItemGroup>

    <Target Name="_UnoValidateRuntimeTargets" AfterTargets="Build">
        <ItemGroup>
            <_FilteredRuntimeCopyLocalItems
              Include="@(RuntimeCopyLocalItems)"
              Condition=" '%(Filename)' == 'Uno.UI.RemoteControl'
                  and $([System.String]::Copy('%(RelativeDir)').Replace('\','/').ToLowerInvariant().Contains('net9.0/skia')) " />
        </ItemGroup>

        <Error Text="The project must not reference Uno.UI.RemoteControl.dll from a net9.0 folder."
               Condition=" '@(_FilteredRuntimeCopyLocalItems)' != '' " />
    </Target>

    <Target Name="_UnoValidatePublishAotAndUnoBindableDescriptorXml"
            Condition=" '$(PublishAot)' == 'true' "
            AfterTargets="Build">
        <PropertyGroup>
            <_UnoBindableDescriptorXmlPath>$(IntermediateOutputPath)Uno.Bindable.Descriptor.xml</_UnoBindableDescriptorXmlPath>
        </PropertyGroup>
        <Error Text="The Uno.Bindable.Descriptor.xml was not generated!"
                Condition="!Exists('$(_UnoBindableDescriptorXmlPath)')" />
        <XmlPeek
                XmlInputPath="$(_UnoBindableDescriptorXmlPath)"
                Query="/linker/assembly[@fullname='uno56netcurrent']/type[@fullname='uno56netcurrent.HelloEntity']">
            <Output TaskParameter="Result" ItemName="_UnoPreserveEntity" />
        </XmlPeek>
        <ReadLinesFromFile
                Condition=" @(_UnoPreserveEntity->Count()) == 0 "
                File="$(_UnoBindableDescriptorXmlPath)">
            <Output TaskParameter="Lines" ItemName="_UnoBindableDescriptorXmlLines" />
        </ReadLinesFromFile>
        <Message
                Condition=" @(_UnoPreserveEntity->Count()) == 0 "
                Text="# Uno.Bindable.Descriptor.xml contents:" Importance="High" />
        <Message
                Condition=" @(_UnoPreserveEntity->Count()) == 0 "
                Text="@(_UnoBindableDescriptorXmlLines, '
')" Importance="High" />
        <Error
                Condition=" @(_UnoPreserveEntity->Count()) == 0 "
                Text="`uno56netcurrent.HelloEntity` not present within `Uno.Bindable.Descriptor.xml`!" />
    </Target>

</Project>
