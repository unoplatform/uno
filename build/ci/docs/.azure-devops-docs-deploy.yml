parameters:
  poolName: ''
  deploymentName: ''
  displayName: ''
  environmentName: ''
  azureSubscription: ''
  storageAccountName: ''

jobs:
- deployment: ${{ parameters.deploymentName }}
  displayName: ${{ parameters.displayName }}
  cancelTimeoutInMinutes: 0
  environment: ${{ parameters.environmentName }}

  pool: ${{ parameters.poolName }}

  strategy:
    runOnce:
      deploy:
        steps:
        - download: none

        - task: DownloadPipelineArtifact@2
          displayName: Download Docs Artifacts
          retryCountOnTaskFailure: 3
          inputs:
            artifactName: DocumentationArtifacts
            targetPath: $(Pipeline.Workspace)/DocumentationArtifacts

        - task: AzureCLI@2
          displayName: Upload site files
          retryCountOnTaskFailure: 3
          inputs:
            azureSubscription: ${{ parameters.azureSubscription }}
            scriptType: pscore
            scriptLocation: inlineScript
            inlineScript: |
              az storage blob upload-batch --account-name ${{ parameters.storageAccountName }} -s "$(Pipeline.Workspace)/DocumentationArtifacts/doc/_site" -d '$web' --overwrite --auth-mode login
